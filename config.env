#!/bin/bash
# ============================================================================
# DevOps Lab Configuration File
# ============================================================================
# This file contains all configurable variables for the DevOps Lab.
# Modify these values according to your environment before running scripts.
# ============================================================================

# =========================
# Cluster Configuration
# =========================
export CLUSTER_NAME="devops-lab"
export K3S_IMAGE="rancher/k3s:v1.35.0-k3s1"  # Use default k3d image, leave empty for latest
export SERVER_COUNT=1                         # Number of server (master) nodes
export AGENT_COUNT=3                          # Number of agent (worker) nodes

# =========================
# Port Mappings
# =========================
export HTTP_PORT=80                           # Host port for HTTP traffic
export HTTPS_PORT=443                         # Host port for HTTPS traffic
export TRAEFIK_DASHBOARD_PORT=8080            # Host port for Traefik dashboard

# =========================
# Hostnames (for /etc/hosts)
# =========================
export APP_HOSTNAME="app.localhost"           # Frontend application
export API_HOSTNAME="api.localhost"           # Backend API
export ARGOCD_HOSTNAME="argocd.localhost"     # ArgoCD UI
export GRAFANA_HOSTNAME="grafana.localhost"   # Grafana dashboard

# =========================
# Namespaces
# =========================
export APP_NAMESPACE="app"                    # Application namespace
export ARGOCD_NAMESPACE="argocd"              # ArgoCD namespace
export MONITORING_NAMESPACE="monitoring"      # Prometheus/Grafana namespace

# =========================
# Docker Image Configuration
# =========================
export BACKEND_IMAGE="lab-backend"
export BACKEND_TAG="v1"
export FRONTEND_IMAGE="lab-frontend"
export FRONTEND_TAG="v1"

# =========================
# Database Configuration
# =========================
export DB_NAME="appdb"
export DB_USER="appuser"
export DB_PASSWORD="apppassword"              # Change in production!
export DB_PORT="5432"

# =========================
# Helm Chart Versions
# =========================
# These versions are compatible with K8s 1.22.x
# Update if using a newer Kubernetes version
export ARGOCD_CHART_VERSION="4.10.9"
export PROMETHEUS_STACK_VERSION="39.13.3"
export LOKI_STACK_VERSION="2.10.2"
export KEDA_CHART_VERSION="2.12.1"

# =========================
# GitOps Configuration
# =========================
export GIT_REPO_URL="https://github.com/yoloxsta/devops-labs.git"
export GIT_TARGET_REVISION="HEAD"
export GITOPS_PATH="gitops-root/templates"

# =========================
# Grafana Configuration
# =========================
export GRAFANA_ADMIN_USER="admin"
export GRAFANA_ADMIN_PASSWORD="admin"         # Change in production!

# =========================
# ArgoCD Configuration
# =========================
# Note: Initial password is auto-generated and stored in a secret
# This just sets the username
export ARGOCD_ADMIN_USER="admin"

# =========================
# CI/CD Configuration
# =========================
export CI_NAMESPACE="ci"
export JENKINS_HOSTNAME="jenkins.localhost"
export REGISTRY_HOSTNAME="registry.ci.svc.cluster.local"
export REGISTRY_PORT="5000"

# =========================
# Resource Limits (Optional)
# =========================
export BACKEND_MEMORY_REQUEST="64Mi"
export BACKEND_MEMORY_LIMIT="128Mi"
export BACKEND_CPU_REQUEST="50m"
export BACKEND_CPU_LIMIT="200m"

export FRONTEND_MEMORY_REQUEST="32Mi"
export FRONTEND_MEMORY_LIMIT="64Mi"
export FRONTEND_CPU_REQUEST="25m"
export FRONTEND_CPU_LIMIT="100m"

export POSTGRES_MEMORY_REQUEST="128Mi"
export POSTGRES_MEMORY_LIMIT="256Mi"
export POSTGRES_CPU_REQUEST="100m"
export POSTGRES_CPU_LIMIT="250m"

# =========================
# Helper Functions
# =========================

# Color codes for output
export RED='\033[0;31m'
export GREEN='\033[0;32m'
export YELLOW='\033[1;33m'
export CYAN='\033[0;36m'
export NC='\033[0m'

echo_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
echo_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
echo_error() { echo -e "${RED}[ERROR]${NC} $1"; }
echo_header() { echo -e "\n${CYAN}=== $1 ===${NC}\n"; }

# =========================
# Derived Variables
# =========================
export BACKEND_FULL_IMAGE="${BACKEND_IMAGE}:${BACKEND_TAG}"
export FRONTEND_FULL_IMAGE="${FRONTEND_IMAGE}:${FRONTEND_TAG}"
